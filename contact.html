<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contato - Visualizador de Nota Fiscal XML</title>
  <!-- Link para o Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Estilos globais para o corpo da página e variáveis de cor */
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f8f9fa; /* Fundo cinza claro */
      color: #333; /* Cor de texto padrão */
      display: flex; /* Usar flexbox para o layout principal */
      flex-direction: column; /* Conteúdo em coluna */
      min-height: 100vh; /* Ocupa a altura total da viewport */
    }

    :root {
      --primary-orange: #f26522; /* Laranja principal */
      --primary-blue: #003366; /* Azul principal */
    }

    /* Estilos para títulos */
    h1, h4, h5 {
      font-weight: 600; /* Negrito */
      color: var(--primary-blue); /* Cor azul */
    }

    /* Estilos para o cabeçalho do card */
    .card-header {
      background-color: var(--primary-orange); /* Fundo laranja */
      color: white; /* Texto branco */
      font-weight: 500;
      border-bottom: 2px solid var(--primary-blue); /* Borda inferior azul */
    }

    /* Estilos para todos os cards */
    .card {
      border: 2px solid #adb5bd; /* Borda cinza mais escura */
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Sombra suave */
      border-radius: 8px; /* Bordas arredondadas */
    }

    /* Estilo para a sobreposição do loader (indicador de carregamento) */
    .loader-overlay {
      position: fixed; /* Fixado na tela */
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7); /* Fundo semi-transparente */
      z-index: 9999; /* Acima de tudo */
      display: none; /* ESCONDIDO POR PADRÃO */
      flex-direction: column; /* Conteúdo em coluna */
      justify-content: center; /* Centraliza verticalmente */
      align-items: center; /* Centraliza horizontalmente */
      border-radius: 8px; /* Bordas arredondadas */
    }
    .loader {
      border: 8px solid #f3f3f3; /* Borda cinza clara */
      border-top: 8px solid var(--primary-orange); /* Borda superior laranja (para o spinner) */
      border-radius: 50%; /* Faz um círculo */
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite; /* Animação de rotação */
    }
    .loader-text {
      color: white; /* Texto branco */
      margin-top: 10px; /* Espaço entre o spinner e o texto */
      font-size: 1rem;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Estilos para as seções de conteúdo (agora páginas separadas) */
    .content-section {
      padding: 40px 20px;
      flex-grow: 1; /* Permite que ocupe o espaço disponível */
      text-align: center; /* Centraliza o conteúdo da seção */
    }

    .content-section h1 {
      margin-bottom: 30px;
      text-align: center;
    }

    .content-section p {
      margin-bottom: 15px;
      text-align: justify; /* Justifica o texto para melhor leitura */
      max-width: 800px; /* Limita a largura do parágrafo */
      margin-left: auto; /* Centraliza o parágrafo */
      margin-right: auto; /* Centraliza o parágrafo */
    }

    .content-section ul {
        list-style-type: disc;
        margin-left: auto; /* Centraliza a lista */
        margin-right: auto; /* Centraliza a lista */
        max-width: 800px; /* Limita a largura da lista */
        padding-left: 40px; /* Ajusta o padding para a lista */
        text-align: justify; /* Justifica o texto da lista */
    }

    .content-section ul li {
        margin-bottom: 8px;
    }

    /* Estilo para o botão de voltar */
    .btn-back-to-main {
        margin-top: 20px;
        background-color: var(--primary-blue);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 10px 20px;
        transition: background-color 0.3s ease;
    }

    .btn-back-to-main:hover {
        background-color: #002244; /* Azul mais escuro no hover */
    }

    /* Estilos para o rodapé */
    .footer {
      background-color: var(--primary-blue);
      color: white;
      padding: 20px 15px;
      text-align: center;
      font-size: 0.9rem;
      margin-top: auto; /* Empurra o rodapé para o final da página */
    }

    .footer a {
      color: white;
      text-decoration: none;
      margin: 0 10px;
      transition: text-decoration 0.3s ease;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    /* Estilo para o logo na navbar */
    .navbar-brand img {
      height: 30px; /* Altura do logo */
      margin-right: 10px; /* Espaçamento à direita do logo */
      border-radius: 4px; /* Bordas arredondadas para o logo na navbar */
      background-color: transparent; /* Fundo transparente para o logo */
      padding: 0; /* Remove o preenchimento */
    }

    /* Estilos do formulário de contato */
    .contatocampos {
        background: #ebeff1;
        color: #596364;
        margin-bottom: 27px;
        border-radius: 8px; /* Adicionado para consistência */
        overflow: hidden; /* Garante que o conteúdo não vaze do border-radius */
    }

    .contatocampos input,
    .contatocampos select,
    .contatocampos textarea {
        color: #596364; /* Cor de texto mais escura para melhor contraste */
        font-size: 18px; /* Ajustado para um tamanho mais comum */
        background: #ebeff1;
        line-height: 2.5rem; /* Ajustado para melhor espaçamento */
        width: 100%;
        border: 0;
        outline: 0;
        padding: 0 15px; /* Adicionado padding para os inputs */
        box-sizing: border-box; /* Inclui padding na largura total */
    }

    .contatocampos textarea {
        padding: 15px; /* Mais padding para textarea */
        min-height: 120px; /* Altura mínima para textarea */
        resize: vertical; /* Permite redimensionar verticalmente */
    }

    .contatocampos span {
        color: #596364; /* Cor de texto mais escura para o span */
        font-size: 18px; /* Ajustado para um tamanho mais comum */
        background: #ebeff1;
        line-height: 2.5rem; /* Ajustado para melhor espaçamento */
        width: 100%;
        border: 0;
        outline: 0;
        display: inline-block;
        padding: 0 15px; /* Adicionado padding para o span */
        box-sizing: border-box;
        text-align: left; /* Alinha o texto do span à esquerda */
    }

    .butenviar {
        cursor: pointer;
        border: 0px none;
        padding: 12px 30px; /* Ajustado padding */
        font-size: 16px; /* Ajustado tamanho da fonte */
        font-weight: bold;
        font-family: 'Segoe UI', sans-serif; /* Consistente com o body */
        color: white;
        background-color: var(--primary-orange); /* Usando a cor laranja principal */
        border-radius: 8px; /* Bordas arredondadas */
        transition: background-color 0.3s ease;
    }

    .butenviar:hover {
        background-color: #d85c1b; /* Laranja um pouco mais escuro no hover */
    }

    .contato-form-container {
        max-width: 600px; /* Largura máxima para o formulário */
        margin: 0 auto; /* Centraliza o formulário */
        background-color: white;
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        margin-top: 30px;
        margin-bottom: 30px;
    }

    .contato-form-container h1 {
        color: var(--primary-blue);
        font-size: 2.2rem;
        margin-bottom: 15px;
    }

    .contato-form-container #texto2 {
        font-size: 1.1rem;
        color: #666;
        margin-bottom: 30px;
    }

    .contatocampos table {
        width: 100%;
        border-collapse: collapse; /* Remove espaçamento entre células */
    }

    .contatocampos table td {
        padding: 0; /* Remove padding padrão da célula */
        vertical-align: middle;
    }

    /* Estilos para a primeira célula da tabela (onde os ícones ficavam) */
    .contatocampos table td:first-child {
        /* Removido: width: 50px; */ /* Largura não necessária se não há ícone */
        padding: 15px; /* Mantém o padding para espaçamento */
        /* Removido: display: flex; */
        /* Removido: align-items: center; */
        /* Removido: justify-content: center; */
    }

    /* Removidos todos os estilos para .img-cont e suas variações */

    /* Estilos para a barra de progresso de upload */
    .barra-fundo {
        width: 100%;
        background-color: #ddd;
        border-radius: 5px;
        margin-top: 10px;
        height: 20px;
        position: relative;
    }

    .barra {
        height: 100%;
        width: 0%;
        background-color: var(--primary-orange);
        border-radius: 5px;
        transition: width 0.3s ease-in-out;
    }

    #BarraTexto {
        position: absolute;
        width: 100%;
        top: 0;
        left: 0;
        text-align: center;
        color: white;
        line-height: 20px;
        text-shadow: 1px 1px 1px black;
    }

    /* Responsividade para telas menores */
    @media (max-width: 768px) {
      .content-section h1 {
        font-size: 1.5rem;
      }
      .footer a {
          display: block;
          margin: 5px 0;
      }
      .contato-form-container {
        padding: 20px;
      }
      .contatocampos input,
      .contatocampos select,
      .contatocampos textarea,
      .contatocampos span {
        font-size: 16px;
        line-height: 2rem;
      }
      .butenviar {
        padding: 10px 20px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #003366;">
    <div class="container">
      <a class="navbar-brand" href="/">
        NF-e Viewer
      </a>
    </div>
  </nav>

  <!-- Seção Contato -->
  <div id="contact-section" class="content-section container">
    <div class="contato-form-container">
        <h1 id="texto1">CONTATO</h1>
        <div id="texto2">Dúvidas, erro ou sugestão. Escreva aqui.</div>

        <div id="divDados">
            
            <div class="contatocampos" id="divEmail">
                <table>
                    <tbody>
                        <tr>
                            <td><!-- Ícone de e-mail removido --></td>
                            <td>
                                <input type="email" id="email" placeholder="Seu Email">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="contatocampos" id="divMotivo">
                <table>
                    <tbody>
                        <tr>
                            <td><!-- Ícone de tipo removido --></td>
                            <td>
                                <select id="motivo" onchange="MotivoSeleciona()" style="cursor: pointer">
                                    <option>Motivo do Contato</option>
                                    <option disabled=""></option>
                                    <option>Dúvida</option>
                                    <option>Erro</option>
                                    <option>Sugestão</option>
                                    <option>Outros</option>
                                </select>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="contatocampos" id="divArquivos" style="display: none">
                <table>
                    <tbody>
                        <tr>
                            <td><!-- Ícone de printscreen removido --></td>
                            <td style="text-align: left">
                                <input type="file" name="arquivo" id="arquivo" class="arquivo" multiple="multiple" data-multiple-caption="{count} imagens selecionadas" accept="image/*">
                                <label for="arquivo" style="width: 100%; display: inline-block;"><span style="text-align: left">Enviar PrintScreen</span></label>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="contatocampos" id="divDescricao">
                <textarea id="descricao" cols="20" rows="5" placeholder="Escreva aqui"></textarea>
            </div>
            <div id="divBotao" style="text-align: right;">
                <input class="butenviar" type="button" value="ENVIAR" onclick="Enviar();">
            </div>
        </div>
    </div>
    <div class="text-center mt-4">
        <button class="btn btn-back-to-main" onclick="window.location.href='/'">Voltar</button>
    </div>
  </div>

  <!-- Rodapé da Página -->
  <footer class="footer">
    <div>
      © 2025 NF-e Viewer. Todos os direitos reservados.
    </div>
    <div class="mt-2">
      <a href="/sobre">Sobre</a> |
      <a href="/politica-de-privacidade">Política de Privacidade</a> |
      <a href="/termos-de-uso">Termos de Uso</a> |
      <a href="/contato">Contato</a>
    </div>
  </footer>

  <!-- Link para o Bootstrap JS (com Popper.js) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Função auxiliar para obter elementos por ID, como no seu código original
    function ele(id) {
        return document.getElementById(id);
    }

    // Funções de modal (stubs, pois a implementação completa não está no escopo do frontend)
    // Você precisaria ter essas funções definidas globalmente ou incluí-las aqui
    function MsgInf(message, callback) {
        // Implementação de um modal de informação simples
        alert(message); // Usando alert como fallback, idealmente seria um modal customizado
        if (callback) callback();
    }

    function MsgQue(message, callbackYes, callbackNo) {
        // Implementação de um modal de pergunta simples
        if (confirm(message)) { // Usando confirm como fallback
            if (callbackYes) callbackYes();
        } else {
            if (callbackNo) callbackNo();
        }
    }

    function MsgB(content) {
        // Implementação de um modal de barra de progresso ou mensagem de carregamento
        // Para este exemplo, vamos usar o loader overlay existente ou criar um simples
        const loaderOverlay = document.getElementById('loaderOverlay');
        const loaderText = document.getElementById('loaderText');
        if (loaderOverlay && loaderText) {
            loaderText.innerHTML = content.replace(/<div[^>]*BarraTexto[^>]*>(.*?)<\/div>/, '$1'); // Extrai o texto
            loaderOverlay.style.display = 'flex';
        } else {
            console.log("MsgB content:", content); // Fallback para console
        }
    }

    function MsgF() {
        // Função para fechar o modal ou loader
        const loaderOverlay = document.getElementById('loaderOverlay');
        if (loaderOverlay) {
            loaderOverlay.style.display = 'none';
        }
    }

    // Lógica do formulário de contato
    function MotivoSeleciona() {
        if (ele('motivo').value == 'Erro') {
            ele('descricao').placeholder = 'Descreva aqui com detalhes sobre o erro. É muito importante você enviar um printscreen da tela de quando acontece o erro.';
            ele('divArquivos').style.display = 'block';
        } else {
            ele('descricao').placeholder = 'Escreva aqui';
            ele('divArquivos').style.display = 'none';
        }
    }

    async function Enviando() {
        const PROXY_BASE_URL = 'https://nefinfo.onrender.com'; // Certifique-se que esta URL está correta para seu proxy

        var fileInput = ele('arquivo');
        var formData = new FormData();

        for (var i = 0; i < fileInput.files.length; i++) {
            formData.append('arquivo', fileInput.files[i]);
        }
        formData.append('email', ele('email').value);
        formData.append('pagina', document.referrer);
        formData.append('motivo', ele('motivo').value);
        formData.append('descricao', ele('descricao').value);

        try {
            // Exibir barra de progresso (simulada ou real se o servidor suportar)
            ele('Barra').style.width = '0%';
            ele('BarraTexto').innerHTML = '0% Completo.';

            const response = await fetch(`${PROXY_BASE_URL}/send-contact-email`, {
                method: 'POST',
                body: formData
            });

            // Simular progresso para o frontend, já que fetch não tem onprogress para upload
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                if (progress <= 100) {
                    ele('Barra').style.width = progress + '%';
                    ele('BarraTexto').innerHTML = progress + '% Completo.';
                } else {
                    clearInterval(interval);
                }
            }, 100);


            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Erro ao enviar a mensagem.');
            }

            const result = await response.json();
            clearInterval(interval); // Parar simulação de progresso
            ele('Barra').style.width = '100%';
            ele('BarraTexto').innerHTML = '100% Completo.';

            if (result.status === 'OK') {
                MsgF(); // Fecha o modal de progresso
                ele('texto1').innerHTML = 'Mensagem enviada';
                ele('texto2').innerHTML = 'A resposta será feita no e-mail informado.';
                ele('divDados').style.display = 'none'; // Oculta o formulário
            } else {
                MsgInf(result.message || 'Ocorreu um erro ao enviar a mensagem.');
            }

        } catch (error) {
            clearInterval(interval); // Parar simulação de progresso em caso de erro
            MsgF(); // Fecha o modal de progresso
            console.error("Erro ao enviar contato:", error);
            MsgInf('Erro ao enviar a mensagem: ' + error.message);
        }
    }

    function Enviar() {
        // Limpa bordas de erro anteriores
        ele('divEmail').style.border = '0px none';
        ele('divMotivo').style.border = '0px none';
        ele('divDescricao').style.border = '0px none';

        // Validações
        if (ele('email').value.trim() == '') {
            ele('divEmail').style.border = '2px solid red';
            MsgInf('É necessário informar o seu e-mail', function () { ele('email').focus(); });
            return;
        }
        if (ele('email').value.indexOf("@") == -1) {
            ele('divEmail').style.border = '2px solid red';
            MsgInf('É necessário informar um e-mail válido.', function () { ele('email').focus(); });
            return;
        }
        if ((ele('motivo').value.trim() == 'Motivo do Contato')) {
            ele('divMotivo').style.border = '2px solid red';
            MsgInf('É necessário informar o motivo.', function () { ele('motivo').focus(); });
            return;
        }
        if (ele('descricao').value.trim() == '') {
            ele('divDescricao').style.border = '2px solid red';
            MsgInf('É necessário escrever sobre o seu contato', function () { ele('descricao').focus(); });
            return;
        }

        // Confirmação e envio
        MsgQue('Deseja realmente enviar ?',
            function () {
                MsgB('<div style="padding: 15px">' +
                     '<div class="lab">Enviando mensagem...</div>' +
                     '<div class="barra-fundo">' +
                     '<div id="Barra" class="barra" style="width: 0%"></div>' +
                     '<div id="BarraTexto" style="color: white; text-align: center; white-space:nowrap; position: relative; width: 100%; margin-top: -20px; text-shadow: 1px 1px 1px black">0 %</div>' +
                     '</div></div>');
                document.onkeydown = null; // Desabilita keydown enquanto envia
                Enviando();
            },
            null
        );
    }

    // Lógica para o input de arquivo (label dinâmico)
    document.addEventListener('DOMContentLoaded', function() {
        var inputs = document.querySelectorAll('#arquivo');
        Array.prototype.forEach.call(inputs, function (input) {
            var label = input.nextElementSibling,
                labelVal = label.innerHTML;

            input.addEventListener('change', function (e) {
                var fileName = '';
                if (this.files && this.files.length > 1)
                    fileName = (this.getAttribute('data-multiple-caption') || '').replace('{count}', this.files.length);
                else
                    fileName = e.target.value.split('\\').pop();

                if (fileName)
                    label.querySelector('span').innerHTML = fileName;
                else
                    label.innerHTML = labelVal;
            });
        });
    });
  </script>
</body>
</html>
